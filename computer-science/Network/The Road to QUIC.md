[The Road to QUIC](https://blog.cloudflare.com/the-road-to-quic/) 

- QUIC은 암호화가 기본으로 되어있는 새로운 인터넷 전송 프로토콜이다. 이것은 HTTP 트래픽을 가속화하기 위해서 몇가지 향상을 이루었다. 뿐만 아니라 보안적인 측면에서도 더욱 강화되었으며, TCP와 TLS가 도달하고자 하는 궁극적인 목적까지도 달성했다. 이 블로그 포스트에서는 QUIC의 대략적인 내용에 대해서 살펴볼 것이다. 그리고 이것들이 어떻게 웹을 이롭게 만들어주는지도 살펴볼 것이다. 
- 이 프로토콜은 구글 엔지니어에 의해서 설계된 프로토콜이었다. 실험적인 몇년이 지난 후에 IETF에 의해서 표준으로 받아들여지게 되었다. 

그래서 QUIC이 제공해주는 이점은 무엇인가? 

## Built - in security (and performance) 

- TCP와 달리 QUIC의 큰 장점이 있다면 바로 내장된 보안 기능이라는 것이다. QUIC은 전송계층 그 자체에서 보안과 관련된 기능을 수행한다. (어떻게 전송계층에서 이것이 가능해 진 것인가? TCP에서는 어떻게 보안이 이루어지는가?)
- TCP에서 3-way-handshake를 통해서 하던 작업을 QUIC은 TLS1.3과 함꼐 단 한번만에 수행한다. 여기에는 end-point 인증과 암호화 매개변수 협상도 포함되어있다. 
- 이렇게 함으로써 커넥션이 항상 인증화되고 암호화되어 있을 뿐만 아니라, 결과적으로 초기 연결을 더 빠르게 만들 수 있게 되었다. 일반적인 QUIC 핸드쉐이크는 서버와 클라이언트 사이에 한번의 round-trip만 필요하다. 

![[스크린샷 2023-03-04 오후 11.10.47.png]]


![[스크린샷 2023-03-04 오후 11.11.03.png]]

## Head-of-line blocking 

- HTTP2에 의해서 새롭게 소개된 기능은 멀티플렉싱이다. 이 기능은 똑같은 TCP 연결 위헤서 다른 http 요청들을 보낼 수 있다. 이것은 http2 어플리케이션이 동시적으로 요청을 보낼 수 있게하고, 네트워크 대역폭을 사용하기에 더 용이하게 만든다. 
- 이런 기능은 이전에 비해서 엄청난 향상이었다. 이전에는 다수의 TCP+TLS 연결을 만들어야 했다. 다수의 http1.1요청을 만들기 위해서는. 이렇게 많은 연결을 만들어내는 것은 반복적으로 핸드 쉐이크를 여러번 해야했다. 하지만 이런 모든 일들을 멀티플렉싱은 해소해주었다. 
- 하지만 이 멀티플렉싱에도 단점은 존재한다. 이 다수의 요청와 응답들 또한 똑같이 TCP 연결 위에서 전송되기 때문에, 그들은 동일하게 packet 손실에 영향을 받는다. 심지어 하나의 요청에서 손실된 데이터라고 할지라도. 이것을 가리켜 holb 라고 한다. 
- QUIC은 동일한 연결에서 스트림을 주고받지만, 해당 전송스트림은 다른 스트림이다. 때문에 각각의 스트림은 독립적이고, 그래서 대부분의 경우 패킷 손실은 다른 스트림에 영향을 미치지 않는다. 

- 하지만 문제점이 존재할 수 있는 것은 UDP라는 것이다. QUIC은 UDP 위에 지어졌다. UDP를 선택함으로써 얻을 수 있는 이점이 존재하지만, 또 다른 문제점도 같이 따라온다. 그 문제점이란 UDP 상에서는 오용되거나 정확한 엔드포인트로 전송하는 것이 더 어렵다는 것이다. 

##  One NAT to bring them all and in the darkness bind them

- 전통적인 NAT 라우터는 TCP 커넥션을 추적할 수 있다. 전통적인 4가지 튜플을 활용해서(소스의 ip 주소와 port, 목적지의 ip 주소와 포트). 그리고 네트워크상에서 전송되는 TCP의 SYN, ACK, FIN 패킷을 관찰함으로써,  그들은 새로운 커넥션이 생성되거나, 제거되는 것을 감지할 수 있다. 이런 방식을 통해서 추적할 수 있다는 것이다. 
- 이렇게 하는 것은 그것들을 더 정확하게 관리할 수 있게 해준다. NAT 바인딩의 lifetime을, 그리고 연결 내부적인 Ip 주소와 port 그리고 외부적인것 사이의 연결. =>  아, 그러니까 위의 과정을 통해서 NAT 바인딩이라는 작업을 더 정확하게 할 수 있다는 말인 것 같다. 
- QUIC을 통해서는 이것이 아직까지 가능하지는 않다. NAT 라우터는 아직 이 프로토콜을 이해할 수가 없기 때문에, NAT 라우터 상에서는 QUIC을 이용할 수가 없다. 
- QUIC의 한 가지 기능은 커넥션 마이그레이션이다. 이 기능은 다른 ip 주소로 QUIC 엔드포인트를 마이그레이트 할 수 있게 해준다. 예를 들어서, 모바일 클라이언트는 QUIC 커넥션을 마이그레이트 하는 것이 가능해질 것이다. 셀룰러 데이터 네트워크와 와이파이 사이에서.  
- QUIC은 이 문제를 해결하기 위해서 제시하는 개념은 "connection ID"이다. QUIC 패킷에 의해서 임의의 수가 주어지면, 이것을 커넥션을 식별하기 위해서 사용할 수 있다. 이 아이디가 있으면 TCP에서 사용하던 4-tuple이 없이도, 커넥션을 트래킹하는 것이 가능하다. 



## [QUIC Connection id](https://www.phind.com/search?cache=2842f1d8-61d0-438c-9dae-728a0d5ab1ad) 

- QUIC은 general-purpose 한 전송 계층 네트워크 프로토콜이다. 이것은 TCP을 이용하고 있는 현대의 연결 지향적인 웹 어플리케이션의 성능을 향상하기 위해서 설계되었다. 