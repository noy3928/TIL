## HTTP1.1's caching machanism 

HTTP/1.1 은 분산 정보 시스템의 성능을 향상시키기 위해 캐싱 기능을 사용하도록 설계되었다. HTTP1.1의 캐싱 메커니즘은 캐싱이 잘 동작하도록 여러 요소를 포함한다. 주요 캐시 키는 요청 방법과 대상 URI이며, 적절한 캐시 키로 정의된 경우 GET 이외의 응답도 캐시 엔트리의 일반적인 형태가 된다. 
Vary 헤더는 캐시된 응답을 사용할 수 있는지 여부를 결정하기 위해서 미래 요청 헤더를 어떻게 일치시킬지 결정한다. max-age=N요청 지시어는 클라이언트가 원본 서버에서 생성 저장된 응답을 N초 이내에 사용할 수 있다는 것을 나타낸다. 


--- 

## [HTTP Cache로 불필요한 네트워크 요청 방지](https://web.dev/i18n/ko/http-cache/) 

### 브라우저 호환성 

실제로 HTTP 캐시라는 단일 api는 존재하지 않는다. 웹 플랫폼 API 집합에 대한 일반적인 이름이라고 보면 된다. 이러한 API는 모든 브라우저에서 지원되는 기능이다. 
- Cache-Control 
- ETag 
- Last-Modified 

### HTTP 캐시 작동 방식 

- 브라우저가 제공하는 모든 HTTP 요청은 먼저 브라우저 캐시로 라우팅되어 요청을 수행하는 데 사용할 수 있는 유효한 캐시 응답이 있는지 확인한다. 
	- (요청을 보내면 먼저 캐싱되어 있는 데이터가 있는지 확인한다는 말) 
- 일치하는 항목이 있으면 캐시에서 응답을 읽어 네트워크 대기 시간과 전송으로 인해 발생하는 데이터 비용을 모두 제거한다. 
	- (캐시된 응답을 보내게 되면 데이터 전송에 필요한 비용이 발생하지 않는다는 말이다. )

- HTTP 캐시의 동작은 요청 헤더와 응답 헤더의 조합에 의해서 제어된다. 이상적인 시나리오에서는 웹 애플리케이션의 코드와 웹 서버의 구성을 모두 제어할 수 있다. 
	- 그러니까 헤더를 어떻게 조작하느냐에 따라서 캐시의 동작이 달라질 수 있다는 것이다. 이 헤더에도 2가지 헤더, 응답 헤더와 요청헤더. 이 2가지를 조작함으로써 동작이 달라지는 것이다. 


### 요청헤더 : 기본값 유지(일반) 
- 웹 앱의 송신 요청에 포함되어야 하는 중요한 헤더가 많다. 하지만 브라우저는 요청을 할 때 거의 항상 사용자를 대신해서 브라우저가 직접 헤더를 설정한다. 
- `If-None-Match` 나 `If-Modified-Since` 는 새로 고침 검사에 영향을 미치는 요청 헤더이다. 이런 헤더들은 HTTP 캐시의 현재 값에 대해서 브라우저가 어떻게 이해하고 있느냐에 따라서 표시되는 값이 달라진다. 
	- [[If-None-Match]]
- 이것은 좋은 소식이 될 수 있다. 왜냐하면 HTML에 `<img src="my-image.png" >` 와 같은 태그를 계속 포함할 수 있다는 의미가 되며, 브라우저는 별도의 작업 없이도 사용자를 위해서 자동으로 HTTP캐시를 처리한다는 의미가 되기 대문이다. 


### 응답헤더 : 웹 서버 구성 

HTTP 캐싱 설정에서 가장 중요한 부분은 웹 서버가 각 발신 응답에 추가하는 헤더이다. 다음의 헤더들은 모두 효과적인 캐싱 동작에 영향을 미치는 것들이다. 

- Cache-Control : 서버는 Cache-Control 지시문을 반환하여 브라우저 및 기타 중간 캐시가 개별 응답을 캐시하는 방법과 기간을 지정할 수 있다. 
- ETag : 브라우저가 만료된 캐시 응답을 찾으면 작은 토큰(일반적으로 파일 내용의 해시)을 서버로 보내 파일이 변경되었는지 확인할 수 있다. 서버가 동일한 토큰을 반환하면 파일이 동일하므로 다시 다운로드할 필요가 없다. 
- Last-Modified : 이 헤더는 ETag와 동일한 목적을 위해서 사용된다. 하지만 시간 기반 전략을 사용한다. 그래서 ETag의 콘텐츠 기반 전략과 반대로 리소스가 변경되었는지 여부를 판단한다. [[Last-Modified]]

일부 웹 서버는 기본적으로 해당 헤더를 설정할 수 있도록 지원하는 기능이 내장되어 있다. 하지만 다른 웹 서버는 헤더를 명시적으로 구성하지 않는 한 헤더를 완전히 생략한다. 헤더를 구성하는 방법에 대한 구체적인 세부 정보는 사용하는 웹 서버에 따라서 상당히 달라진다. 때문에 가장 정확한 세부 정보를 얻으려면 서버 설명서를 참조해야 한다. 

Cache-Control 응답 헤더를 생략한다 할지라도, HTTP 캐싱이 비활성화되지는 않는다. 대신, 브라우저는 어떤 유형의 캐싱 동작이 주어진 유형의 내용에 가장 적합한지 효과적으로 추측한다. 응답 헤더를 구성하는 것보다 더 많은 제어 권한을 원할 수도 있다. 그렇다면 조금 더 신경을 써서 응답 헤더를 구성해보자. 


### 어떤 응답 헤더 값을 사용해야할까? 

웹 서버의 응답 헤더를 구성할 때 다루어야 하는 두 가지 중요한 시나리오가 있다. 