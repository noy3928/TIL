
# 05. 클로저

#클로저 

- 링크자료 : 
	- [[클로저 - 함수형 자바스크립트 프로그래밍]]

- 클로저의 정의 : 
	- A closure is the combination of a function and the lexical environment within which that function was declared. 

- 여기서 말하는 선언될 당시의 lexical environment의 의미 
	- 실행 컨텍스트의 구성 요소 중 outerEnvironmentReference 에 해당한다. 
- combination의 의미 
	- 내부함수 B가 A의 lexicalEnvironment를 언제나 사용하는 것은 아니다. 
	- 내부함수에서 외부 변수를 참조하지 않는 경우라면 combination이라고 할 수 없다. 
	- 내부함수에서 외부 변수를 참조하는 경우에 한해서만 combination, 즉 '선언될 당시의 LexicalEnvironement와의 상호관계'가 의미있다. 


## 02 클로저와 메모리 관리

- 메모리 누수 : 
	- 개발자의 의도와 달리 어떤 값의 참조 카운트가 0이 되지 않아 GC가 수거의 대상이 되지 않는 현상 
	- 만약 개발자가 해당 상황을 의도한 것이라면 메모리 누수라고 할 수 없다. 
- 참조 카운트를 0으로 만드는 방법 : 
	- 식별자에 참조형이 아닌 기본형 데이터를 할당하면 된다. (보통 null이나 undefined를 할당)


## 03 클로저의 활용 사례


### 5.3.1 콜백 함수 내부에서 외부 데이터를 사용하고자 할 때

```javascript
const fruits = ['apple', 'banana', 'peach']
const $ul = document.createElement('ul')

fruits.forEach(function(fruit){
	const $li = document.createElement('li')
	$li.innerText = fruit;
	$li.addEventListener('click', function(){
		alert('your choice is' + fruit);
	});
	$ul.appendChild($li);
})
document.body.appendChild($ul)
```


### 5.3.2 접근 권한 제어(정보 은닉) 

- 정보 은닉은 어떤 모듈의 내부 로직에 대해 외부로의 노출을 최소화해서 모듈 간의 결합도를 낮추고 유연성을 높이고나 하는 현대 프로그래밍 언어의 중요한 개념 중 하나이다. 
- 자바스크립트에서 함수 내의 변수들 중 일부 변수에게만 외부에서 접근 가능하도록 하는 방법은 무엇인가? 
	- return을 활용하면 가능하다. 
	- return 값이 외부에 정보를 제공하는 유일한 수단이 된다. 
	- 외부에 제공하고자 하는 정보들을 모아서 return하고, 내부에서만 사용할 정보들은 return 하지 않는 것으로 접근 권한 제어가 가능한 것이다.


### 5.3.3 부분 적용 함수 

- 부분 적용 함수란 n 개의 인자를 받는 함수에 미리 m개의 인자만 넘겨 기억시켰다가, 나중에 (n-m)개의 인자를 넘기면 비로소 원래 함수의 실행 결과를 얻을 수 있게끔 하는 함수다. 

```javascript
const add = function(){
	let result = 0;
	for(let i = 0; i < arguments.length; i++){
		result += arguments[i];
	}
	return result;
}
const addPartial = add.bind(null, 1,2,3,4,5)
console.log(addPartial(6,7,8,9,10))
```


- 디바운스 
	- 짧은 씨간 동안 동일한 이벤트가 많이 발생할 경우 이를 전부 처리하지 않고 처음 또는 마지막에 발생한 이벤트에 대해 한 번만 처리하는 것으로, 프론트엔드 성능 최적화에 큰 도움을 주는 기능 중 하나이다. 

```javascript
const debounce = function(eventName, func, wait){
	var timeoutId = null;
	return function(event){
		let self = this;
			console.log(eventName, 'event 발생');
			clearTimeout(timeoutId);
			timeoutId = setTimeout(func.bind(self, event), wait);
	};
}

const moveHandler = function(e){
		console.log('move event 처리');
}

const wheelHandler = function(e){
		console.log('wheel event 처리');
}

document.body.addEventListener('mousemove', debounce('move', moveHandler, 500));
document.body.addEventListener('mousewheel', debounce('wheel', wheelHandler, 700));

	
```



### 5.3.4 커링 함수 

#커링 

- 커링함수란 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것을 말한다. 
	- 커링은 한 번에 하나의 인자만 전달하는 것을 원칙으로 한다. 
	- 중간 과정상의 함수를 실행한 결과는 그 다음 인자를 받기 위해 대기만 할뿐이다. 
	- 마지막 인자가 전달되기 전까지는 원본 함수가 실행되지 않는다. 
- 각 단계에서 받은 인자들을 모두 마지막 단계에서 참조할 것이므로 GC되지 않고 메모리에 차곡차곡 쌓였다가, 마지막 호출로 실행 컨텍스트가 종료된 후에야 비로소 한꺼번에 GC의 대상이 된다. 


---

<br>
## 질문 리스트 : 

- [[부분 적용 함수와 커링은 어떤 차이점이 있는가?]]
- 지연평가가 유익한 이유는 무엇인가? 
	- 재사용 가능한 함수를 만들어낼 수 있다. (커링의 맥락에서)
	- 성능을 최적화할 수 있다. 
		- 즉시 평가하는 경우 성능이 나빠지는 경우가 있다. 하지만 지연 평가는 이를 방지할 수 있다. 
- 함수형과 객체지향에서 클로저는 어떤 역할을 하는가? 
	- [[함수형의 맥락에서 클로저는 왜 중요한가?]]
	- [[객체지향의 맥락에서 클로저는 왜 중요한가?]] 