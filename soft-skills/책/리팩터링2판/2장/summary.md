# 2.리팩터링 원칙

## 1.리팩터링 정의

> 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

- 리팩터링은 겉보기 동작은 그대로 유지한다는 것이 중요하다. 리팩터링을 하면서 기능이 변경되면 안된다. 기능이 변경되면 리팩터링을 잘못한 것이다.
- 리팩터링은 내부 구조를 변경한다는 것이다. 내부 구조를 변경한다는 것은 코드를 변경한다는 것이다. 코드를 변경한다는 것은 버그가 발생할 수 있다는 것이다. 그렇기 때문에 리팩터링을 할 때는 테스트 코드가 있어야 한다. 테스트 코드가 없다면 리팩터링을 하지 말아야 한다.
- 내 생각 : 2장을 읽으면서 정말 많이 하게 된 생각은 테스트 코드의 중요성이다. 좋은 코드를 만들기 위해서는 리팩터링이 필요하고, 리팩터링을 위해서는 테스트코드가 필요하다. 고로 좋은 코드를 만들기 위해서는 테스트코드가 필수적이다.

## 2.두 개의 모자

- 하나의 작업을 할 때는 딱 하나의 일만해야한다. 기능을 추가할 때는 기능을 추가하는 일만한다. 리팩터링을 할 때는 리팩터링만 한다.

## 3. 리팩터링을 하는 이유

- 리팩터링은 좋은 설계를 가지게 한다. 지속적으로 리팩터링을 하다보면 구조의 구조를 지탱할 수 있다.
- 소프트웨어를 이해하기 쉽게 만든다. 리팩터링은 나 뿐만이 아니라, 다른 개발자도 읽기 쉽게 만드는 것에 목적이 있다.
- 버그를 찾기 쉽게 만든다. 리팩터링을 하다보면, 구조를 파악하게 된다. 그리고 구조가 더욱 명확하게 된다. 그렇기 때문에 버그를 찾기 쉬워진다.
- 프로그래밍 속도를 높여준다. 리팩터링을 하면 코드를 이해하기 쉬워지고, 버그를 찾기 쉬워지기 때문에 프로그래밍 속도가 높아진다. 처음에는 속도가 느린것처럼 느껴질 수 있지만, 점점 시간이 지날수록 속도가 더욱 높아진다.

## 4. 언제 리팩터링해야할까?

- 새 기능을 추가할 때 : 구조를 살짝만 바꾸면 다른 작업을 하기가 쉬워질만한 부분이 존재한다. 해당 부분을 찾아서 리팩터링을 수행한다.
- 기존의 코드가 명확하지 않다고 느껴질 때.
- 간단한 수정이면 즉시 고친다. 시간이 좀 걸리는 일은 메모를 한 후, 하던 일을 끝내고 나서 처리한다.
  - 처음 봤을 때보다 항상 깔끔하게 정리하고 떠나자.
- 리팩터링 일정을 따로 잡지 않는다.수시로 한다.
- 버그를 수정하려면 현재 소프트웨어의 작동 방식을 이해해야한다. 이때도 리팩터링부터 하는 편이 가장 빠르다.

## 5. 리팩터링 시 고려할 문제

- 리팩터링의 본질은 코드 베이스를 예쁘게 꾸미는 데 있지 않다. 오로지 경제적인 이유로 하는 것이다. 리팩터링은 개발 기간을 단축하고자 하는 것이다. 기능 추가 시간을 줄이고, 버그 수정 시간을 줄여준다.
- 리팩터링을 하기 위해서는 테스트코드를 마련해야 한다. 테스트 코드는 리팩터링을 할 수 있게 해줄 뿐만 아니라, 새 기능 추가도 훨씬 안전하게 진행할 수 있도록 도와준다. 실수로 만든 버그를 빠르게 찾아서 제거할 수 있기 때문이다.

## 6. 리팩터링, 아키텍처, 애그니(YAGNI)

- 현재까지 파악한 요구사항만을 해결하는 소프트웨어를 구축한다. 요구사항을 예측해서 유연성있는 메커니즘을 구현하려할 때, 자칫 함수가 복잡해질 위험이 있다. 이런 상황에서는 리팩터링을 통해 코드를 깔끔하게 정리하고, 요구사항이 추가될 때 리팩터링을 통해 유연성을 추가해나가는 것이 좋다.
  - 이것을 YAGNI라고 한다. (you aren't gonna need it) 그리고 이것은 리팩터링의 뒷받침 없이는 효과를 볼 수 없는 기법이다.

## 7. 리팩터링과 소프트웨어 개발 프로세스

- 애자일을 제대로 적용하려면 리팩터링에 대한 팀의 역량과 열정이 뒷받침 되어 프로세스 전반에 리팩터링이 자연스럽게 스며들도록 해야한다.
- 리팩터링의 첫 번째 토대는 자가 테스트 코드이다. 다시 말해 프로그래밍 도중 발생한 오류를 확실히 걸러내는 테스트를 자동으로 수행할 수 있어야 한다.

## 8. 리팩터링과 성능

- 의도적으로 성능 최적화에 돌입하기 전까지는 성능에 신경쓰지 않고 코드를 다루기 쉽게 만드는 데 집중한다. 그러다 성능 최적화 단계가 되면 다음의 구체적인 절차를 따른다.
  - 먼저 성능을 측정한다.
  - 성능에 영향을 미치는 부분'만' 개선한다.
  - 컴파일과 테스트를 수행한다.
  - 이렇게 작은 단계를 반복한다.
- 리팩터링이 잘 되어있다면 기능 추가가 빨리 끝나서 성능에 집중할 시간을 더 벌 수 있다. 또한 리팩터링이 잘 되어 있는 프로그램은 성능을 더 세밀하게 분석할 수 있다. 프로파일러가 지적해주는 코드의 범위가 더 좁아질 것이고, 그래서 튜닝하기 쉬워진다. 코드가 깔끔하면 개선안들이 더 잘 떠오를 것이고, 그중 어떤 튜닝이 효과가 좋을지 파악하기 쉽다.

---

> 무언가를 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고(단, 만만치 않을 수 있다) 그런 다음 쉽게 수정하자. - 켄트 백

> 코드를 분석할 때 리팩터링을 해보면, 그렇지 않았더라면 도달하지 못했을 더 깊은 수준까지 이해하게 된다. - 마틴 파울러
