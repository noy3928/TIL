
# 8. 계층형 설계(1) 


- 이 장의 결론 : 계층간 설계를 위한 4가지 단계 중에서 첫번째 단계인 "직접 구현" 패턴에 대해서 알아보았다. 
- 요점 정리 : 
	- 계층형 설계는 코드를 추상화 계층으로 구성한다. 각 계층을 볼 때 다른 계층에 구체적인 내용을 몰라도 된다. 
	- 문제해결을 위한 함수를 구현할 때 어떤 구체화 단계로 사용할 지 결정하는 것이 중요하다. 그래야 함수가 어떤 계층에 속할지 알 수 있다. 
	- 함수가 어떤 계층에 속할지 알려주는 요소는 많다. 함수 이름과 본문, 호출 그래프 등이 그런 요소이다. 
	- 함수 이름은 의도를 알려준다. 비슷한 목적의 이름을 가진 함수는 함께 묶을 수 있다. 
	- 함수 본문은 중요한 세부 사항을 알려준다. 함수 본문은 함수가 어떤 계층 구조에 있어야 하는지를 알려준다. 
	- 호출 그래프로 구현이 직접적이지 않다는 것을 알 수 있다. 함수를 호출하는 화살표가 다양한 길이를 가지고 있다면 직접 구현되어 있지 않다는 신호다. 
	- 직접 구현 패턴은 함수를 명확하고 아름답게 구현해 계층을 구성할 수 있도록 알려준다. 



## 계층형 설계란 무엇인가? 

- 계층형 설계는 소프트웨어를 계층으로 구성하는 기술이다. 각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의한다. 
- 계층이란 무엇인가?  : 계층에는 비즈니스 규칙, 장바구니를 위한 동작들, 카피-온-라이트, 언어에서 지원하는 배열 관련 기능 등등이 존재할 수 있다. 각 계층을 정확하게 구분하는 것은 어렵다. 
- 계층은 어떻게 잘 구분할 수 있을까? : 구분하기 위한 다양한 변수를 찾고 찾은 것을 가지고 어떻게 해야 하는지 알아야 한다. 결국 좋은 설계 감각을 가지면 계층을 잘 구분할 수 있다. 
- 좋은 설계 감각은 어떻게 키울 수 있을까? : 이 장에서 그 방향을 배울 것이다. 코드를 읽을 때 더 좋은 설계를 알려주는 신호를 찾는 법을 배울 것이다. 설계를 개선하고, 개선한 것이 어떤 의미가 있는지 알아볼 것이다. 


## 설계 감각을 키우기 

설계 감각을 키우기 위한 여러가지 입력 데이터들이 존재한다. 

|함수 본문|계층 구조|함수 시그니처|
|-|-|-|
|길이|화살표 길이|함수명|
|복잡성|응집도|인자 이름|
|구체화 단계|구체화 단계|인잣값|
|함수 호출| | | 
|프로그래밍 언어의 기능 사용| | |


출력 데이터들 
|조직화|구현|변경|
|-|-|-|
|새로운 함수를 어디에 놓을지 결정 | 구현 바꾸기 | 새 코드를 작성할 곳 선택하기|
|함수를 다른 곳으로 이동 | 함수 추출하기 | 적절한 수준의 구체화 단계 결정하기 | 
| |데이터 구조 바꾸기 | |



## 계층형 설계 패턴 : 

### 패턴1 : 직접 구현 

직접 구현된 함수를 읽을 때, 함수 시그니처가 나타내고 있는 문제를 함수 본문에서 적절한 구체화 수준에서 해결해야 한다. 만약 너무 구체적이라면 코드에서 나는 냄새이다. 

### 패턴2 : 추상화 벽 

호출 그래프에 어떤 계층은 중요한 세부 구현을 감추고 인터페이스를 제공한다. 인터페이스를 사용하여 코드를 만들면 높은 차원으로 생각할 수 있다. 고수준의 추상화 단계만 생각하면 된다. 

### 패턴3 : 작은 인터페이스 

중요한 인터페이스는 작고 강력한 동작으로 구성되는 것이 좋다. 

### 패턴4 : 편리한 계층 

계층을 구분함으로써 작업할 때 편리해지는 것이 중요하다. 

<br>

## 패턴 1 : 직접 구현 

중요한 것은 함수 내에 존재하는 기능들의 추상화 수준이 동일한지 확인하는 것이다. 호출 그래프를 통해서 함수 내부의 기능을 시각화한다. 이렇게 하고나면, 함수 내부의 추상화수준이 동일한지를 확인할 수 있다. 만약 함수내에 추상화 단계가 다른 코드가 많게 된다면 이 함수를 읽는 것이 어려워진다. 

만약 서로 다른 추상화 단계에 있는 기능을 사용하면 직접 구현 패턴이 아니다. 만약 함수 내부에서 사용하고 있는 기능들의 추상화 단계를 맞추면 직접 구현에 가까워질 수 있다. 

이렇게 직접 구현패턴을 통해서 함수를 구현하게 되면, 함수들을 계층별로 나누기가 쉬워진다. 


### 같은 계층에 있는 함수는 같은 목적을 가져야 한다. 

같은 계층에 있는 함수들이 같은 목적을 가지게 되고, 명확해진다면 함수가 위치할 계층을 선택하는 데 좋은 정보로 사용할 수 있다. 계층의 목적은 각 계층에 있는 함수의 목적과 같다. 


### 직접 구현은 어떻게 계층형 설계에 도움이될까? 

계층형 줌 레벨로 보면 함수가 가리키는 화살표를 계층 간에 비교할 수 있게 된다. 

직접 구현 패턴을 사용하면 모든 화살표가 같은 길이를 가져야 한다. 하지만, 다이어그램을 확인하면 어떤 화살표는 한 계층 길이를 가지고 있고, 어떤 화살표는 세 계층 길이를 가지고 있다. 이렇게 다양한 계층을 넘나드는 것은 같은 구체화 수준이 아니라는 증거이다. 

또한 하나의 함수 안에서도 같은 계층의 함수를 사용할 수 있도록 만들어야 한다. 그렇게 해야 화살표의 길이를 맞출 수 있다. 


