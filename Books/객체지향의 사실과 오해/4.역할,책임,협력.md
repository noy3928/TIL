# 04.역할, 책임, 협력 

> 우리 모두를 합친 것보다 더 현명한 사람은 없다. - 켄 블랜차드 

- 인간은 이기적이고 합리적인 존재일까? 
	- 일반적으로는 그렇지만, 그 사람이 처해있는 문맥이 어떠하냐에 따라서 행동은 달라진다. 
	- 이번 장에서 이야기하려는 객체의 특성도 그렇다. 
	- 객체는 철저히 협력 관계속에서 어떤 역할을 담당할 지로 바라봐야 한다. 
		- 협력 관계속에서 어떤 역할을 감당할 것인지에 따라, 그에게 책임이 부여되고, 그 책임에 따라서 행동을 하게 된다.
	- 객체지향 설계의 품질은 곧 객체들의 협력의 품질이다. 
	- 이번 장에서 살펴 볼 내용은 역할, 책임, 협력의 개념이다. 


## 협력 

### 요청하고 응답하며 협력하는 사람들  

- 협력과 요청 : 
	- 협력은 특정 객체가 자신의 일을 다른 객체에게 요청할 때 이루어진다. 
		- 자신보다 더 전문가에게 자신이 해야 할 일을 위임-요청하는 것이다. 
		- 그리고 요청받은 전문가는 또 다른 전문가에게 자신의 일을 위임-요청할 수 있다.
		- 이렇게 연쇄적으로 요청이 이루어지면서 협력관계가 이루어진다. 

### 재판 속의 협력 

- 재판 과정에서의 협력관계를 살펴보자 
	- 왕 : 누군가 왕에게 재판을 해달라고 요청했다. 
		- 왕에게는 재판을 수행할 의무가 있다. 
		- 왕에게는 재판에 필요한 지식을 가지고 있다. 
	- 토끼 : 왕이 토끼에게 목격자를 불러오라고 요청했다. 
		- 토끼는 목격자를 부를 의무가 있다.
		- 토끼는 목격자에 대해서 알고 있다. 
	- 모자 장수 : 왕이 모자 장수에게 증언하라고 요청했다. 
		- 모자장수는 재판에 도움이 될 만한 사건의 내용에 대해 조금이라도 알고 있다. 
		- 모자장수는 증언할 의무가 있다. 
- 등장인물들이 특정한 요청을 받아들일 수 있는 이유 : 
	- 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과 행동 방식을 가지고 있기 때문이다. 


## 책임

- 의무와 책임 : 
	- 누군가에게 "이 일을 해야할 의무가 있어" 라고 말하는 것은 그 사람에게 해당 일을 할 책임이 있다는 것을 의미한다. 
	- 누군가에게 "이 일을 해줘" 라고 "요청"하는 것은 그 사람에게 해당 "책임"이 부여된다는 것을 의미한다.
- 책임 - 객체지향설계의 가장 중요한 재료 : 
	- 크레이그 라만 - `객체지향 개발에서 가장 중요한 능력은 책임을 능숙하게 소프트웨어 객체에 할당하는 것`
	- 책임을 어떻게 구현할 것인가?는 나중에 고민해도 괜찮다. 먼저 고려해야하는 것은 객체와 책임이 적절한 자리에 자리잡도록하는 것이다. 

### 책임의 분류

- 책임의 정의 : 
	- `객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 알아야 하는 정보와 객체가 수행할 수 있는 행위에 대해 개략적으로 서술한 문장이다.` 
	- 객체의 책임의 2가지 구성요소 : 
		- Knowing : 객체가 무엇을 알고 있는가
		- Doing : 객체가 무엇을 할 수 있는가
	- 이런 책임으로부터 공용 인터페이스가 구성된다. 


### 책임과 메시지 

- 메시지 : 
	- 객체가 자신의 책임을 수행하는 순간은 다른 객체에게 '요청'을 받았을 때다. 
	- 우리고 우리는 이 요청을 `메시지 전송`이라고 부른다.
	- 이런 메시지의 관점에서 볼 때, 메시지를 받는 객체를 `수신자`그리고 메시지를 보내는 객체를 `송신자`라고 한다. 

## 역할 

### 책임의 집합이 의미하는 것

- 책임의 집합 : 
	- 책임의 집합을 모아보았다. 
		- 왕의 책임은 재판한다. 증인에게 참석하도록 요구한다. 라는 책임이 있다. 이것을 보아하니 왕의 역할은 '판사'였다. 
		- 모자장수의 책임은, 증인석에 입장한다. 증언한다. 라는 책임이 있었다. 이것을 보아하니, 모자장수의 역할은 '증인'이었다. 
	- 책임의 집합을 모아보면, 역할이라는 추상화된 개념이 도출된다. 

### 역할이 답이다

- 역할 : 
	- 역할이 정해져있다면, 해당 역할을 수행할 수 있는 어떤 객체든지 대체할 수 있다. 
		- 왕이 머리가 아파서, 자신이 수행하던 판사의 역할을 여왕에게 넘겼다. 이렇게 역할의 개념이 추상화되어 존재하면, 해당 역할을 수행할 수 있는 객체가 언제든지 그 자리를 대체할 수 있다. 
	- 객체가 역할을 수행하기 위한 최소한의 조건 : 
		- 객체에 송신되는 메시지를 이해할 수 있어야 한다. 
		- 동일한 역할을 수행하는 객체들이 동일한 메시지를 수신할 수 있기 때문에 동일한 책임을 수행할 수 있다는 것은 매우 중요한 개념이다. p.126 


### 협력의 추상화 

- 역할의 가치 : 
	- 역할의 가장 큰 가치는 하나의 협력 안에 여러 종류의 객체가 참여할 수 있게 함으로서 협력을 추상화할 수 있다는 것이다. 
	- 역할을 이용하면 협력을 추상화함으로써 단순화할 수 있다. 구체적인 객체로 추상적인 역할을 대체해서 동일한 구조의 협력을 다양한 문맥에서 재사용할 수 있는 능력은 객체지향만의 힘이다. 
	- 그리고 이런 힘은 대체가능성으로부터 나온다.

### 대체 가능성

- 역할의 대체가능성 : 
	- 객체가 역할을 대체하기 위해서는 행동 호환성이 보장되어야 한다. 
	- 협력 안에서 역할이 수행하는 모든 책임을 동일하게 수행할 수 있어야 한다. 
	- 한 가지 더 생각해 볼 지점은 객체는 역할이 암시하는 것보다 더 많은 책임을 가질 수 있다는 것이다. 
		- 때문에 이를 일반화/특수화 관계로 생각해볼 수 있다. 
		- 역할 - 객체 
		- 일반화 - 특수화 


## 객체의 모양을 결정하는 협력 


### 흔한 오류 

- 선입견 : 
	- 객체의 존재 이유에 대한 오류 : 시스템에 필요한 데이터를 저장하기 위해 객체가 존재한다는 선입견을 가지고 있다. 
	- 객체지향이 클래스와 클래스 간의 관계를 표현하는 시스템의 정적인 측면에 중점을 둔다는 것
- 바른생각 : 
	- 객체가 존재하는 이유 : 행위를 수행하며 협력에 참여하기 위해서 존재한다. 
	- 객체지향의 핵심은 클래스를 어떻게 구현할 것인가가 아니다. 객체가 협력 안에서 어떤 책임과 역할을 수행할 것인지를 결정하는 것이다. 


### 협력을 따라 흐르는 객체의 책임 

- 우선순위 : 
	- 협력을 먼저 설계해야한다. 이는 설계에 참여하는 객체들이 주고받을 요청과 응답의 흐름을 결정한다는 것을 의미한다. 
	- 협력의 문맥에서 객체가 수행하게 될 적절한 책임, 즉 행동을 결정한 다음 그 행동을 수행하는 데 필요한 데이터를 고민해야한다. 
	- 협력 -> 책임 -> 데이터 순으로 진행되는 것이다. 
- 객체지향 설계의 품질 : 
	- 협력에 필요한 책임을 결정하고 객체에게 책임을 할당하는 과정을 얼마나 합리적이고 적절하게 수행했는지가 객체지향 설계의 품질을 결정한다. 


## 객체지향 설계 기법 

### 책임-주도 설계 

- 객체지향 설계 : 
	- 애플리케이션의 기능을 구현하기 위한 협력 관계를 고안하고, 협력에 필요한 역할과 책임을 식별한 후 이를 수행할 수 있는 적절한 객체를 식별해나가는 과정 
- 책임-주도설계 : 
	- 책임-주도 설계는 개별적인 객체의 상태가 아니라, 객체의 책임과 상호작용에 집중한다. 결과적으로 시스템은 스스로 자신을 책임질 수 있을 정도로 충분히 자율적인 동시에 다른 객체와 우호적으로 협력할 수 있을 정도로 충분히 협조적인 객체들로 이뤄진 생태계를 구성하게 된다. 
- 책임-주도설계의 절차 : 
	- 1) 시스템이 사용자에게 제공해야하는 기능인 시스템 책임을 파악한다. 
	- 2) 시스템 책임을 더 작은 책임으로 분할한다. 
	- 3) 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다. 
	- 4) 객체가 책임을 수행하는 중에 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다. 
	- 5) 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다. 



### 디자인 패턴 

- 책임 주도와 디자인 패턴 : 
	- 책임주도 설계는 방법과 절차를 제시한다. 
	- 디자인 패턴은 책임주도 설계의 결과를 표현한다. 
- 패턴 : 
	- 패턴은 모범이 되는 설계다. 
	- 패턴은 해결하는 문제가 무엇인지를 명확하게 서술하고, 패턴을 적용할 수 있는 상황과 적용할 수 없는 상황을 함께 설명한다. 
	- 패턴은 반복해서 반복해서 일어나는 특정한 상황에서 어떤 설계가 왜(why) 더 효과적인지에 대한 이유를 설명한다. 



### 테스트-주도 개발 

- TDD와 객체지향 : 
	- 객체가 이미 존재한다고 가정하고 객체에게 어떤 메시지를 전송할 것인지에 관해 먼저 생각하라고 충고한다. 
		- 객체와 객체가 수신할 메시지에 대해서 생각하는 것이 테스트로 나타나는 것이다. 
	- 테스트-주도 개발은 테스트를 작성하는 것이 아니다. 책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것이다. 
	- TDD는 객체지향에 대한 깊이 있는 지식을 요구한다. 
		- 테스트를 작성하기 위해 객체의 메서드를 호출하고 반환값을 검증한다. 이것은 객체가 수행해야하는 책임에 관해 생각한 것이다. 
		- 테스트에 필요한 간접 입력 값을 제공하기 위해 스텁을 추가하거나 간접 출력 값을 검증하기 위해 목 객체를 사용하는 것은 객체와 협력해야 하는 협력자에 관해 고민한 결과를 코드로 표현한 것이다. 
