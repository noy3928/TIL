# 책임 할당하기

- 책임 주도 설계의 어려움 : 어떤 객체에게 어떤 책임을 할당할지 결정하는 것이 쉽지 않다.
  - 책임할당과정은 일종의 트레이드 오프 활동이다.
- GRASP 패턴 :
  - 책임 할당의 어려움을 해소해준다.

## 1. 책임 주도 설계를 향해

- 책임 중심 설계의 2가지 원칙 :
  - 데이터보다 행동을 먼저 결정하라
  - 협력이라는 문맥 안에서 책임을 결정하라
- 결국 핵심은 '책임'과 '문맥'에 초점을 맞추라는 것이다

<br>

### 데이터보다 행동을 먼저 결정하라

- 객체에게 중요한 것은 외부에 제공하는 "행동"이다.
  - 이 행동은 곧 책임을 말하는 것.
  - 데이터는 후순위다.
- 책임 중심으로 무게 중심을 옮기는 기법 - 질문법 :
  - "이 객체가 수행해야 하는 책임은 무엇인가"
  - "이 객체가 책임을 수행하는 데 필요한 데이터는 무엇인가"
- 가장 중요한 것은 객체에게 적절한 책임을 할당하는 능력을 갖추는 것이다.

<br>

### 협력이라는 문맥 안에서 책임을 결정하라

- 객체에게 할당된 책임의 품질은 어떻게 측정하는가? :
  - 협력에 적합한 정도로 결정된다.
  - 객체에게 할당된 책임이 협력에 어울리지 않는다면 그 책임은 나쁜 것이다.
  - 책임은 협력에 적합해야 한다.
- 메시지가 먼저 존재하고, 책임이 그 다음이다.
  - 메시지를 결정한 다음 메시지를 처리할 객체를 선택한다.
- 메시지 중심 질문 :
  - "메시지를 전송해야 하는데 누구에게 전송해야 하지?"

<br>

### 책임 주도 설계

- 책임 주도 설계의 흐름 :
  1. 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
  2. 시스템 책임을 더 작은 책임으로 분할한다.
  3. 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
  4. 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 객체 또는 역할을 찾는다.
  5. 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

## 2. 책임 할당을 위한 GRASP 패턴

- GRASP 패턴
  - General Resopnsibility Assignment Software Pattern

<br>

### 도메인 개념에서 출발하기

- 설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다.

<br>

### 정보 전문가에게 책임을 할당하라

- 어플리케이션의 책임을 먼저 생각한다.
  - 그 다음 책임을 감당할 첫 번째 객체를 선택한다.
- 메시지를 전송할 객체는 무엇을 원하는가?
  - "1. 예매하라"
- 메시지를 수신할 적합한 객체는 누구인가?
  - 객체에게 책임을 할당하는 첫 번째 원칙은 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당하는 것이다.
  - 이를 INFORMATION EXPERT 패턴이라고 한다.
  - 정보 전문가 패턴
  - 현재는 "Screening" 객체가 가장 전문가인 것 같다. Screening에게 책임을 맡기자.
- 각각의 객체가 감당할 수 있는 일과 없는 일은 무엇인지를 반복해서 구분하는 작업을 진행한다.

<br>

### 높은 응집도와 결합도

- 높은 응집도와 낮은 결합도는 객체에 책임을 할당할 때 항상 고려해야 하는 기본 원리다.
  - 다양한 대안이 존재한다면, 응집도와 결합도. 2가지를 고려하자.
  - LOW COUPLING, HIGH COHESION
- Screening이 DiscountCondition과 협력하면 새로운 결합도가 추가된다.
  - 따라서 Screening 보다는 Movie가 할인조건과 협력하는 것이 결합도 측면에서 더 나은 설계가 된다.
- 응집도를 판단하는 방법 :
  - 객체가 서로 다른 이유로 변경되는 책임을 가지고 있는가?
  - 변경되는 이유가 다양할 수록 응집도는 낮아진다.

<br>

### 창조자에게 객체 생성 책임을 할당하라

- CREATOR 패턴
  - 이 패턴의 의도는 어떤 방식으로돈 생성되는 객체와 연결되거나 관련될 필요가 있는 객체에게 생성의 책임을 맡기는 것이다. 다음의 조건을 만족하는 객체에게 생성의 책임을 맡긴다.
    - B가 A 객체를 포함하거나 참조한다.
    - B가 A 객체를 기록한다.
    - B가 A 객체를 긴밀하게 사용한다.
    - B가 A 객체를 초기화하는 데 필요한 데이터를 가지고 있다.
- '예매'를 위한 정보를 알고 있는 객체는 '상영'이다.
  - 고로 '상영' 객체는 '예매'를 생성할 책임을 가지게 된다.

## 3. 구현을 통한 검증

- 변경에 취약한 클래스란 코드를 수정해야 하는 이유를 하나 이상 가지는 클래스다.
- 여러가지 변경의 이유를 가지는 클래스가 있다면, 각 변경의 이유에 따라 클래스를 분리시켜야 한다.
- 클래스의 응집도를 판단하는 방법 :
  - 클래스가 하나 이상의 이유로 변경되야 한다면, 응집도가 낮은 것이다. 변경의 이유를 기준으로 클래스를 분리하라.
  - 클래스의 인스턴스를 초기화하는 시점에 경우에 따라 서로 다른 속성들을 초기화하고 있다면 응집도가 낮은 것이다. 초기화되는 속성의 그룹을 기준으로 클래스를 분리하라.
  - 메서드 그룹이 속성 그룹을 사용하는지 여부로 나뉜다면 응집도가 낮은 것이다. 이들 그룹으로 클래스를 분리하라.
- 다형성을 통한 분리
  - 객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당한다.
  - 객체의 타입에 따라 변하는 로직이 있을 때 변하는 로직을 담당할 책임을 어떻게 할당해야하는가?
    - 타입을 명시적으로 정의하고 각 타입에 다형적으로 행동하는 책임을 할당하라.
- 변경을 캡슐화하기
  - PROTECTED VARIATIONS
  - 변화가 예상되는 불안정한 지점들을 식별하고 그 주위에 안정된 인터페이스를 형성하도록 책임을 할당할 것
  - 설계에서 변하는 것이 무엇인지 고려하고 변화하는 개념을 캡슐화하라
  - 클래스를 변경에 따라 분리하고 인터페이스를 이용해 변경을 캡슐화하는 것은 설계의 결합도와 응집도를 향상시키는 매우 강력한 방법이다.

<br>

## 4. 책임 주도 설계의 대안

- 책임주도설계는 어렵다. 익숙해지는데에 시간이 걸린다.
- 그럼 어떻게해야하는가?
  - 우선 최대한 빠르게 목적하는 기능을 수행하는 코드를 작성하자.
  - 아무것도 없는 상태에서 책임과 협력에 관해 고민하기 보다는 일단 실행되는 코드를 얻고 난 후에 코드상에 명확하게 드러나는 책임들을 올바른 위치로 이동시키자.
  - 이렇게 겉으로는 바뀐 것이 없지만, 내부의 구조를 변경하는 것을 리팩터링이라고 한다.
    - 이는 책임을 어디에 둘지 결정하는 것이다.

<br>

### 메서드 응집도

- 몬스터 메서드 : 이해하기 어렵고 재사용도 어렵고 변경도 어려운 메서드.
- 만약 메서드에 주석을 달아야한다면, 그 메서드는 응집도가 낮은 것이다.
  - 주석을 추가하는 대신 메서드를 작게 분해해서 각 메서드의 응집도를 높여야 한다.
- 메서드의 응집도를 높여야 하는 이유

  - 응집도가 높은 메서드는 변경되는 이유가 단 하나다.
  - 클래스가 작고, 목적이 명확한 메서드들로 구성돼 있다면 변경을 처리하기 위해 어떤 메서드를 수정해야 하는지를 쉽게 판단할 수 있다.
  - 또한 메서드의 크기가 작고 목적이 분명하기 때문에 재사용하기도 쉽다.

- 짧은 메서드를 좋아하는 이유 :
  - 메서드가 잘게 나눠져 있을 때 다른 메서드에서 사용될 확률이 높다.
  - 고수준의 메서드를 볼 때 일련의 주석을 읽는 것 같은 느낌이 들게 할 수 있다.
  - 메서드가 잘게 나누어져 있으면 오버라이딩하는 것도 쉽다.
  - 작은 메서드는 이름을 잘 지었을 때만 진가가 드러난다. 때문에 이름을 지을 때 주의해야 한다.

<br>

---

5장에서 나온 패턴들 :

### INFORMATION EXPERT 패턴

정보 전문가 패턴은 객체가 자율적인 존재해야 한다는 사실을 한 번 더 상기시킨다.  
정보를 알고 있는 객체만이 책임을 어떻게 수행할지 스스로 결정할 수 있기 때문이다.  
정보 전문가 패턴을 따르면 정보와 행동을 최대한 가까운 곳에 위치시키기 때문에 캡슐화를 유지할 수 있다.
필요한 정보를 가진 객체들로 책임이 분산되기 때문에 더 응집력 있고, 이해하기 쉬워진다.  
따라서 높은 응집도가 가능하다.

<br>

### LOW COUPLING, HIGH COHESION 패턴

<br>

### CREATOR 패턴

생성되는 객체와 연결되거나 관련될 필요가 있는 객체에 해당 생성 객체를 생성할 책임을 맡기는 것.  
생성될 객체에 대해 잘 알고 있어야 하거나 그 객체를 사용해야 하는 객체는 어떤 방식으로든  
생성될 객체와 연결될 것이다. 다시 말해서 두 객체는 서로 결합된다.

<br>

### POLYMORPHISM 패턴

객체의 타입에 따라 변하는 로직이 있을 때 변하는 로직을 담당할 책임을 어떻게 할당할 것인가?  
타입을 명시적으로 정의하고 각 타입에 다형적으로 행동하는 책임을 할당하라

<br>

### PROTECTED VARIATION 패턴

자주 변경되는 것을 캡슐화하라.
